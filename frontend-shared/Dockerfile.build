FROM node:11-alpine
WORKDIR /user

RUN npm install -g linklocal typescript concurrently rollup webpack
COPY . /user

ENV PUBLIC_URL="/"
ENV API_BASE_URL="${PUBLIC_URL}search"
ENV IMAGE_BASE_URL="${PUBLIC_URL}images/"
ENV APPMODE="PREDICTION"
ENV ENVIRONMENT='production'

RUN npm install \
 && (cd bundled-deps/ui-components && npm run build) \
 && webpack --config webpack.${MODE:-visualizer}.js

FROM nginx
COPY --from=0 /user/dist /frontend
COPY ./nginx.frontend-only.conf /etc/nginx/nginx.conf
