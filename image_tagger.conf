log_format more_loggy '$remote_addr - $remote_user [$time_local] '
                             'req: "$request" $status $body_bytes_sent '
                             '"$http_referer" "$http_user_agent"'
			     'content_length: "$http_content_length"';

map $status $loggable {
    ~^[23]  0;
    default 1;
}


server {
    root /user/src/image-tagger/dist/;
#	server_name deepdive2000;

	# access_log logs/web_access.log;
	access_log off;
	# access_log logs/access.log more_loggy if=$loggable;
#	error_log logs/web_error.log;

	client_max_body_size 20M;

    location / {
#        try_files $uri index.html;
#        location = /index.html {
#            internal;
#            add_header Cache-Control 'no-store';
#        }
    }

    location /image-tagger-api {
        proxy_pass http://image-tagger-api:5454/api;
        proxy_http_version 1.1;
        proxy_set_header Update $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_connect_timeout       300;
        proxy_send_timeout          300;
        proxy_read_timeout          300;
        send_timeout                300;
    }


#    location /image-tagger {
#        proxy_pass http://image-tagger:1234/;
#        proxy_http_version 1.1;
#        proxy_set_header Update $http_upgrade;
#        proxy_set_header Connection 'upgrade';
#        proxy_set_header Host $host;
#        proxy_cache_bypass $http_upgrade;
#        proxy_connect_timeout       300;
#        proxy_send_timeout          300;
#        proxy_read_timeout          300;
#        send_timeout                300;
#    }

#    location /images {
#        root /;
#    }

}
