#!/bin/sh

# Wait for postgresql then run init script

#>&2 echo $(which psql)
#until psql -h db -U postgres -c '\q'; do
  #>&2 echo "Postgres is unavailable - sleeping"
  #sleep 1
#done

#>&2 echo "Postgres is up - executing command"
# Set up the schema
coffee setup.coffee images test

if [ -z "${IMAGE_TAGGER_API_MODE}" ]
then
    echo "No startup mode specified -- assumed prediction ingest."
    MODE='prediction'
else
    MODE='annotate'
fi

if [ "$MODE" = "prediction" ]
then
    npm start &
    python import_predictions.py /xml /images
elif [ "$MODE" = "annotate" ]
then
    #node setup.js images dummy_import &
    npm start
else
    echo "I don't know what to do."
    exit 1
fi

#while true
#do
#    sleep 1
#done


